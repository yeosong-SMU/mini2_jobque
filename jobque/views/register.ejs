<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>회원가입</title>
  <link rel="stylesheet" href="/css/style.css">
  <script>
    function checkPasswordMatch() {
      const pwd = document.getElementById("pwd").value;
      const confirmPwd = document.getElementById("confirmPwd").value;
      const msg = document.getElementById("pwdMsg");

      if (confirmPwd === "") {
        msg.textContent = "";
        return;
      }

      if (pwd === confirmPwd) {
        msg.style.color = "green";
        msg.textContent = "비밀번호가 일치합니다.";
      } else {
        msg.style.color = "red";
        msg.textContent = "비밀번호가 일치하지 않습니다.";
      }
    }
  </script>
  <script>
    let isIdChecked = false;

    async function checkDuplicateId() {
      const userid = document.getElementById('userid').value.trim();
      const msg = document.getElementById('idMsg');
      const checkBtn = document.getElementById('checkBtn');

      if (!userid) {
        msg.style.color = 'red';
        msg.textContent = '아이디를 입력하세요.';
        return;
      }

      const response = await fetch(`/jobque/checkid?userid=${encodeURIComponent(userid)}`);
      const result = await response.json();

      if (result.exists) {
        msg.style.color = 'red';
        msg.textContent = '이미 사용 중인 아이디입니다.';
        isIdChecked = false;
      } else {
        msg.style.color = 'green';
        msg.textContent = '사용 가능한 아이디입니다.';
        isIdChecked = true;
        //checkBtn.disabled = true;
      }
    }

    // 아이디 입력값이 변경되면 다시 중복 확인 필요
    document.getElementById('userid').addEventListener('input', function () {
      const msg = document.getElementById('idMsg');
      const checkBtn = document.getElementById('checkBtn');
      
      isIdChecked = false;
      //checkBtn.disabled = false;
      msg.textContent = '';
    });

    // 폼 제출 전에 중복 확인 여부 검사
    document.querySelector('.register-form').addEventListener('submit', function (e) {
      if (!isIdChecked) {
        e.preventDefault();
        alert('아이디 중복 확인을 해주세요.');
      }
    });
  </script>
</head>
<body>
  <div class="container">
    <h2>회원가입</h2>

    <form action="/jobque/register" method="POST" class="register-form">
      <div>
        <label for="name">이름</label>
        <input type="text" id="name" name="name" required>
      </div>

      <div>
        <label for="userid">아이디</label>
        <input type="text" id="userid" name="userid" required>
        <button type="button" id="checkBtn" onclick="checkDuplicateId()">중복 확인</button>
        <span id="idMsg" class="id-message"></span>
      </div>

      <div>
        <label for="pwd">비밀번호</label>
        <input type="password" id="pwd" name="pwd" required oninput="checkPasswordMatch()">
      </div>

      <div>
        <label for="confirmPwd">비밀번호 확인</label>
        <input type="password" id="confirmPwd" oninput="checkPasswordMatch()" required>
        <span id="pwdMsg" class="pwd-message"></span>
      </div>

      <button type="submit">가입하기</button>
    </form>

    <p>이미 계정이 있으신가요? <a href="/jobque/login">로그인</a></p>
  </div>
</body>

</html>
